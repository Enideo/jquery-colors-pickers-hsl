/*
 Copyright 2010 Enideo. Released under dual MIT and GPL licenses.
*/
(function(d){function w(a,b,c){if(b in a)return a[b](c);else if(b=="RGB"||"RGB"in h.convertModels[b]){if(b!="RGB")c=h.convertModels[b].RGB(c);for(var e in a)if(e=="RGB"||e in h.convertModels.RGB){if(e!="RGB")c=h.convertModels.RGB[e](c);c=d.colors.formats.array3Octet1Normalized.fromModel.RGB(c);return a[e](c)}}throw"No valid conversion methods for this color model: "+b;}function z(a,b){var c=d.colors.models[this.currentModel].parameterIndexes,e=this.currentModel=="RGB"?this.format("array3Octet1Normalized"):
this.color;if(a){a=a.toLowerCase();if(a in c)if(b!==undefined){this.color[c[a]]=b;this.color=d.colors.models[this.currentModel].sanitize(this.color)}else return e[c[a]];else throw"Parameter not in the current color model: "+a;}else return e;return this}function D(){var a=d("<div/>").addClass("scale"),b=d("<div/>").css({zIndex:1,width:160,height:160}),c=d("<span/>").css({position:"absolute",zIndex:3}),e=c.clone().addClass("outline").css({zIndex:2}),f=d("<span/>").addClass("handle");b.add(f).css({position:"absolute",
top:0,left:0});o=d("<div/>").addClass("hslCircleColorPicker").css({position:"relative",width:160,height:185});o.append(a.clone().addClass("h").data("arrayIndex",0).addClass("hSprite").css({width:160,height:160}).append(b.clone().addClass("hSprite").css({backgroundPosition:"-320px 0"})).append(b.clone().addClass("hSprite").css({backgroundPosition:"-160px 0"})));a.css({overflow:"hidden"});b.css({backgroundRepeat:"repeat-x",width:20,height:100});o.append(a.clone().addClass("s").data("arrayIndex",1).css({width:20,
height:100,position:"absolute",top:30,left:70}).append(b.clone().addClass("sSprite").css({backgroundPosition:"0 -200px"})).append(b.clone().addClass("sSprite")).append(b.clone().addClass("sSprite").css({backgroundPosition:"0 -100px"})));o.append(a.clone().addClass("l").data("arrayIndex",2).css({height:20,position:"absolute",top:165,left:0,right:0}));r.append(o);q=o.children("div");q.each(function(i){var g=d(this);if(i==0){g.append(f.clone().append(c.clone().text("+")).append(e.clone().text("+")));
g.children("span").children().each(function(){var j=d(this);j.css({top:-j.height()/2,left:-j.width()/2})})}else if(i==1){g.append(f.clone().append(c.clone().text("\u25b6")).append(c.clone().text("\u25c0")).append(e.clone().text("\u25b6")).append(e.clone().text("\u25c0")));g.children("span").css({right:2}).children().each(function(j){var l=d(this);leftOrRight="left";if(j%2!=0)leftOrRight="right";l.css({top:-l.height()/2}).css(leftOrRight,-l.width()/2)})}else if(i==2){g.append(f.clone().append(c.clone().text("\u25bc")).append(c.clone().text("\u25b2")).append(e.clone().text("\u25bc")).append(e.clone().text("\u25b2")));
g.children("span").css({bottom:2}).children().each(function(j){var l=d(this);topOrBottom="top";if(j%2!=0)topOrBottom="bottom";l.css({left:-l.width()/2-1}).css(topOrBottom,-l.height()/2)})}});k=[Math.random()*360,Math.random()*100,Math.random()*100];x=false;s=t=u=null;q.mousedown(E)}function E(a){function b(g){var j=100;if(i==0){g=Math.atan2(g.pageX-f.left,f.top-g.pageY)/6.28;if(g<0)g+=1;j=360}else g=i==1?(100-(g.pageY-f.top))/100:(g.pageX-f.left)/160;g=g>1?1:g<0?0:g;k[i]=g*j;A();d.isFunction(t)&&
t(d.colors(k,"array1Circle2Percentage","HSL"));return false}function c(){d.isFunction(u)&&u(d.colors(k,"array1Circle2Percentage","HSL"));d(document).unbind("mousemove",b).unbind("mouseup",c);o.data("dragging",false)}var e=d(a.currentTarget),f=e.offset(),i=e.data("arrayIndex");if(i==0){f.top+=80;f.left+=80}y(d(this).closest(".hslCircleColorPicker").parent());if(x)return true;d.isFunction(s)&&s(d.colors(k,"array1Circle2Percentage","HSL"));if(!o.data("dragging")){d(document).bind("mousemove",b).bind("mouseup",
c);o.data("dragging",true)}b(a);return false}function A(){var a,b;q.each(function(){var e=d(this),f=e.data("arrayIndex");e=e.children("span");if(f==0){f=k[f]/360*6.28;e.css({top:-Math.cos(f)*70+80,left:Math.sin(f)*70+80})}else f==1?e.css({top:98-k[f]*100/100}):e.css({left:k[f]*160/100})});var c=k[2]/100;b=(100-k[1])/100;a=[c*b,(1-c)*b];if(k[2]>50){b=(k[2]-50)*2/100;a[0]=Math.max(a[0],b)}else{b=(50-k[2])*2/100;a[1]=Math.max(a[1],b)}q.filter(".h").children("div").each(function(e){d(this).css("opacity",
a[e])});a=k[2]>50?[b,1-b,0]:[0,1-b,b];q.filter(".s").css({backgroundColor:d.colors([k[0],100,50],"array1Circle2Percentage","HSL").toString("rgb")}).children("div").each(function(e){d(this).css("opacity",a[e])});q.filter(".l").css({backgroundColor:d.colors([k[0],k[1],50],"array1Circle2Percentage","HSL").toString("rgb")})}function y(a){r=a;if(r.data("hslCircleColorPickerId")){o=r.children();q=o.children("div.scale");n=r.data("hslCircleColorPickerId");k=p[n].hsl;x=p[n].disabled;s=p[n].onStartChange;
t=p[n].onChange;u=p[n].onEndChange}else{n=(new Date).getTime();r.data("hslCircleColorPickerId",n);D();p[n]={hsl:k,disabled:x,onStartChange:s,onChange:t,onEndChange:u}}}function F(){function a(b){var c,e,f,i,g=[[".hslCircleColorPicker",["display","inline-block"]],[".hslCircleColorPicker>div.scale",["border","1px solid #888"],["cursor","crosshair"]],[".hslCircleColorPicker>div.scale.h",["border-width","0 !important"]],[".hslCircleColorPicker>div.scale.s",["cursor","NS-resize"],["cursor","row-resize"]],
[".hslCircleColorPicker>div.scale.l",["cursor","EW-resize"],["cursor","col-resize"]],[".hslCircleColorPicker>div.scale>span.handle>span",["color","#eee"],["font-size","16px"]],[".hslCircleColorPicker>div.scale>span.handle>span.outline",["color","#333"],["font-size","18px"]],[".hslCircleColorPicker.disabled>div.scale",["cursor","default"]],[".hslCircleColorPicker.disabled>div.scale>span.handle>span",["opacity","0.5"],["filter","alpha(opacity=50)"]]],j,l,m=document.getElementsByTagName("link");if(m.length==
0)m=document.getElementsByTagName("style");if(b===true||this.width!=1||this.height!=1)g=g.concat([[".hslCircleColorPicker .hSprite",["background-image","url('"+d.colors.pickers.hslCircle.pathToImages+"jquery.colors.pickers.hslCircle.sprite.h.png')"]],[".hslCircleColorPicker .sSprite",["background-image","url('"+d.colors.pickers.hslCircle.pathToImages+"jquery.colors.pickers.hslCircle.sprite.s.png')"]],[".hslCircleColorPicker>div.scale.l",["background-image","url('"+d.colors.pickers.hslCircle.pathToImages+
"jquery.colors.pickers.hslCircle.l.png')"]]]);else{j=document.createElement("link");j.type="text/css";j.charset="utf-8";j.rel="stylesheet";j.href=d.colors.pickers.hslCircle.pathToImages+"jquery.colors.pickers.hslCircle.css";m.length!=0?document.getElementsByTagName("head")[0].insertBefore(j,m[0]):document.getElementsByTagName("head")[0].appendChild(j)}j=document.createElement("style");j.type="text/css";j.charset="utf-8";j.rel="stylesheet";c=0;for(e=g.length;c<e;c++){l=[g[c][0],"{"];f=1;for(i=g[c].length;f<
i;f++)l.push(g[c][f].join(":"),";");l.push("}");g[c]=l.join("")}g=g.join("");m.length!=0?document.getElementsByTagName("head")[0].insertBefore(j,m[0]):document.getElementsByTagName("head")[0].appendChild(j);if(j.styleSheet)j.styleSheet.cssText=g;else d(j).text(g);b!==true&&d(this).remove()}B=true;/MSIE/.test(navigator.appVersion)?a(true):d("<img/>").attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==").one("error load",a).appendTo("body")}var h=function(a,b,c){if(this instanceof
h===false)return new h(a,b,c);if(a&&a instanceof h)return a;this.currentModel=h.defaultModel;if(a){if(typeof a=="string")a=d.trim(a);this.inputColor=a;if(b&&b in h.formats&&h.formats[b].validate(a)===true)this.inputFormat=b;else{if(c===undefined)c=b;for(b in h.formats)if(h.formats[b].validate(a)===true){this.inputFormat=b;break}}if(this.inputFormat){b=h.formats[b];this.inputModel=c||b.model||h.defaultInputModel;a=w(b.toModel,this.inputModel,a);if(this.inputModel!=this.currentModel){a=h.models[this.inputModel].sanitize(a);
a=w(h.convertModels[this.inputModel],this.currentModel,a)}this.color=h.models[this.currentModel].sanitize(a)}}else this.color=h.models[this.currentModel].sanitize();if(this.color)return this;else throw"Color format unknown: "+a;};h.prototype={get:z,set:z,model:function(a){if(a===undefined)return this.currentModel;else if(a==this.currentModel)return this;else if(a in h.models){this.color=w(h.convertModels[this.currentModel],a,this.color);this.currentModel=a;return this}else throw"Model does not exist";
},format:function(a){var b=this.currentModel=="RGB"&&a!=="array3Octet1Normalized"?this.format("array3Octet1Normalized"):this.color;if(a&&a in h.formats)return w(h.formats[a].fromModel,this.currentModel,b);else throw"Format does not exist";},toString:function(a){if(!a||a in h.formats===false)a=h.defaultString;try{return this.format(a).toString()}catch(b){return this.format(h.defaultString).toString()}},isFormat:function(a){if(a&&a in h.formats)return h.formats[a].validate(this.inputColor);else throw"Format does not exist";
},mixWith:function(a,b){var c=0,e,f,i,g;if(typeof b=="number")g=b;e=this.get();i=this.model();if(d.isArray(a))try{f=h(a)}catch(j){for(c=0;c<a.length;c++){if(a[c]instanceof h==false)a[c]=h(a[c]);f=c==0?a[c].model(i):f.mixWith(a[c],c/(c+1))}}else{if(a instanceof h==false)a=h(a);f=a}f=f.model(i).get();e=e.slice(0);f=f.slice(0);if(g==undefined)g=c?1/(c+1):0.5;for(c=0;c<e.length;c++){if("cycleMixes"in h.models[i]&&h.models[i].cycleMixes[c])if(h.models[i].cycleMixes[c]>0)for(;e[c]>f[c];)f[c]+=h.models[i].cycleMixes[c];
else for(;e[c]<f[c];)f[c]+=h.models[i].cycleMixes[c];e[c]=e[c]*g+f[c]*(1-g)}e=h.models[i].sanitize(e);return d.extend(d.colors(),{color:e,currentModel:i})}};h.formats={array3Octet:{validate:function(a){var b=0;if(d.isArray(a)&&a.length==3){for(;b<3;)if(typeof a[b]=="number"&&a[b]<=255&&a[b]>=0&&/^\d+$/.test(a[b].toString()))b++;else break;if(b==3)return true}return false},toModel:{RGB:function(a){return a.slice(0,3)}},fromModel:{RGB:function(a){return a.slice(0,3)}}},array3Octet1Normalized:{validate:function(a){var b=
0;if(d.isArray(a)&&a.length==4){for(;b<3;)if(typeof a[b]=="number"&&a[b]<=255&&a[b]>=0&&/^\d+$/.test(a[b].toString()))b++;else break;b==3&&a[3]>=0&&a[3]<=1&&b++;if(b==4)return true}return false},toModel:{RGB:function(a){return a.slice(0,4)}},fromModel:{RGB:function(a){var b=0;for(a=a.slice(0,4);b<3;){a[b]=Math.round(a[b]);b++}return a}}},rgb:{validate:function(a,b){var c=1,e;if(a&&typeof a=="string"&&(e=/^rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)$/.exec(a))){for(;c<4;){e[c]=
parseInt(e[c]);if(e[c]<256)c++;else break}if(c==4)if(b){e.shift();return e.slice(0)}else return true}return false},fromModel:{RGB:function(a){return"rgb("+a[0]+","+a[1]+","+a[2]+")"}},toModel:{RGB:function(a){a=h.formats.rgb.validate(a,true);return a===false?null:a}},model:"RGB"}};h.models={RGB:{sanitize:function(a){var b;if(!a||!d.isArray(a))a=[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.random()];for(;a.length<4;)a.length==3?a.push(1):a.push(0);
a=a.slice(0,4);for(b=0;b<a.length;b++){a[b]||(a[b]=0);if(b<3){if(a[b]>255)a[b]=255;if(a[b]<0)a[b]=0}else if(b==3){a[b]=parseFloat(a[b]);if(a[b]>1)a[b]=1;if(a[b]<0)a[b]=0}}return a},parameterIndexes:{r:0,g:1,b:2,a:3,red:0,green:1,blue:2,alpha:3}}};h.convertModels={};h.defaultInputModel=h.defaultModel="RGB";h.defaultString="rgb";d.colors===undefined&&d.extend({colors:h});var v={HSL:{sanitize:function(a){var b;if(!a||!d.isArray(a))a=[Math.floor(361*Math.random()),Math.floor(101*Math.random()),Math.floor(101*
Math.random()),Math.random()];for(;a.length<4;)a.length==3?a.push(1):a.push(0);a=a.slice(0,4);for(b=0;b<a.length;b++){a[b]||(a[b]=0);a[b]=parseFloat(a[b]);if(b==0){for(;a[b]>360;)a[b]-=360;if(a[b]<0)a[b]+=360}else if(b<3){for(;a[b]>100;)a[b]=100;if(a[b]<0)a[b]=0}else if(b==3){if(a[b]>1)a[b]=1;if(a[b]<0)a[b]=0}}return a},parameterIndexes:{h:0,s:1,l:2,a:3,hue:0,saturation:1,lightness:2,alpha:3},cycleMixes:[360,0,0,0],reverseCylce:function(a){this.cycleMixes[this.parameterIndexes[a]]*=-1}}},C={array1Circle2Percentage:{validate:function(a,
b){var c=0;b=b||3;if(d.isArray(a)&&a.length==b){for(;c<b;)if(typeof a[c]=="number"&&a[c]>=0&&(c==0&&a[c]<=360||(c==1||c==2)&&a[c]<=100||c==3&&a[c]<=1))c++;else break;if(c==b)return true}return false},toModel:{HSL:function(a){return a.slice(0,3)}},fromModel:{HSL:function(a){return a.slice(0,3)}}},array1Circle2Percentage1Normalized:{validate:function(a){return C.array1Circle2Percentage.validate(a,4)},toModel:{HSL:function(a){return a.slice(0,4)}},fromModel:{HSL:function(a){return a.slice(0,4)}}}};d.extend(true,
d.colors.convertModels,{RGB:{HSL:function(a){var b=a[0]/255,c=a[1]/255,e=a[2]/255,f=Math.max(b,c,e),i=Math.min(b,c,e),g=f-i,j=(f+i)/2;if(f==i)b=i=0;else{i=j>0.5?g/(2-f-i):g/(f+i);b=f==b?(c-e)/g+(c<e?6:0):f==c?(e-b)/g+2:(b-c)/g+4;b/=6}return[b*360,i*100,j*100,a[3]]}},HSL:{RGB:function(a){function b(j,l,m){if(m<0)m+=1;if(m>1)m-=1;return m<1/6?j+(l-j)*6*m:m<0.5?l:m<2/3?j+(l-j)*(2/3-m)*6:j}var c,e,f,i,g;f=a[0]/360;e=a[1]/100;c=a[2]/100;if(e==0)c=e=f=c;else{i=c<0.5?c*(1+e):c+e-c*e;g=2*c-i;c=b(g,i,f+1/
3);e=b(g,i,f);f=b(g,i,f-1/3)}return[c*255,e*255,f*255,a[3]]}}});d.extend(d.colors.models,v);d.extend(true,d.colors.formats,C);var B,p={},k,x,s,t,u,r,o,q,n;d.fn.hslCircleColorPicker=function(a){var b,c=[];if(typeof a=="string"&&this.data("hslCircleColorPickerId"))return a==="color"?d.colors(p[this.data("hslCircleColorPickerId")].hsl,"array1Circle2Percentage","HSL"):p[this.data("hslCircleColorPickerId")][a];B||F();b=this.each(function(){y(d(this));if(typeof a=="object"){var e=d.colors.models.HSL.parameterIndexes,
f;for(f in a){if(f in e){p[n].hsl[e[f]]=a[f];delete a[f]}if(f==="color"){if(a[f]instanceof d.colors===false)a[f]=d.colors(a[f]);p[n].hsl=a[f].model("HSL").format("array1Circle2Percentage");delete a[f]}}d.extend(p[n],a);p[n].hsl=d.colors.models.HSL.sanitize(p[n].hsl).slice(0,3);y(r);if("disabled"in a)a.disabled?o.addClass("disabled"):o.removeClass("disabled");d.isFunction(s)&&s(d.colors(k,"array1Circle2Percentage","HSL"));d.isFunction(t)&&t(d.colors(k,"array1Circle2Percentage","HSL"));d.isFunction(u)&&
u(d.colors(k,"array1Circle2Percentage","HSL"))}else a==="hsl"&&c.push(k);A()});return c.length>1?c:c.length==1?c[0]:b};if(d.colors.pickers===undefined)d.colors.pickers={};v=d("script");v=v.eq(v.length-1).attr("src").split("/");v.pop();d.colors.pickers.hslCircle={pathToImages:v.join("/")+"/"}})(jQuery);
