/*
 Copyright 2010 Enideo. Released under dual MIT and GPL licenses.
*/
(function(d){function v(a,b,c){if(b in a)return a[b](c);else if(b=="RGB"||"RGB"in g.convertModels[b]){if(b!="RGB")c=g.convertModels[b].RGB(c);for(var f in a)if(f=="RGB"||f in g.convertModels.RGB){if(f!="RGB")c=g.convertModels.RGB[f](c);c=d.colors.formats.array3Octet1Normalized.fromModel.RGB(c);return a[f](c)}}throw"No valid conversion methods for this color model: "+b;}function z(a,b){var c=d.colors.models[this.currentModel].parameterIndexes,f=this.currentModel=="RGB"?this.format("array3Octet1Normalized"):
this.color;if(a){a=a.toLowerCase();if(a in c)if(b!==undefined){this.color[c[a]]=b;this.color=d.colors.models[this.currentModel].sanitize(this.color)}else return f[c[a]];else throw"Parameter not in the current color model: "+a;}else return f;return this}function D(){var a=d("<div/>").css({width:198,backgroundRepeat:"repeat-y",position:"relative",overflow:"hidden"}).addClass("scale"),b=d("<div/>").css({zIndex:1,bottom:0,backgroundRepeat:"repeat-y"}),c=d("<span/>").css({position:"absolute",zIndex:3}),
f=d("<span/>").css({bottom:0}).addClass("handle");b.add(f).css({position:"absolute",top:0,left:0,right:0});n=d("<div/>").addClass("hslLiteColorPicker");n.append(a.clone().addClass("h sprite").data("arrayIndex",0).append(b.clone())).append(a.clone().addClass("s").data("arrayIndex",1).append(b.clone().addClass("sprite").css({backgroundPosition:"-792px 0"})).append(b.clone().addClass("sprite").css({backgroundPosition:"-396px 0"})).append(b.clone().addClass("sprite").css({backgroundPosition:"-594px 0"}))).append(a.clone().addClass("l sprite").data("arrayIndex",
2).css({backgroundPosition:"-198px 0"}));q.append(n);p=n.children("div");f.append(c.clone().text("\u25bc")).append(c.clone().text("\u25b2"));c.addClass("outline").css({zIndex:2});f.append(c.clone().text("\u25bc")).append(c.clone().text("\u25b2"));p.append(f).children().children().each(function(e){var h=d(this),i="top";if(e%2!=0)i="bottom";h.css({left:-h.width()/2-1}).css(i,-h.height()/2)});j=[Math.random()*360,Math.random()*100,Math.random()*100];w=false;r=s=t=null;p.mousedown(E)}function E(a){function b(i){var m=
100;i=(i.pageX-e)/200;i=i>1?1:i<0?0:i;if(h==0)m=360;j[h]=i*m;A();d.isFunction(s)&&s(d.colors(j,"array1Circle2Percentage","HSL"));return false}function c(){d.isFunction(t)&&t(d.colors(j,"array1Circle2Percentage","HSL"));d(document).unbind("mousemove",b).unbind("mouseup",c);n.data("dragging",false)}var f=d(a.currentTarget),e=f.offset().left,h=f.data("arrayIndex");x(d(this).closest(".hslLiteColorPicker").parent());if(w)return true;d.isFunction(r)&&r(d.colors(j,"array1Circle2Percentage","HSL"));if(!n.data("dragging")){d(document).bind("mousemove",
b).bind("mouseup",c);n.data("dragging",true)}b(a);return false}function A(){var a,b;p.each(function(){var c=d(this),f=c.data("arrayIndex"),e=100;if(f==0)e=360;c.children("span").css({left:j[f]*200/e})});if(j[2]>50){b=(j[2]-50)*2/100;a=[b,1-b,0]}else{b=(50-j[2])*2/100;a=[0,1-b,b]}p.filter(".h").children("div").css({backgroundColor:d.colors([0,0,j[2]],"array1Circle2Percentage","HSL").toString("rgb")}).css("opacity",Math.max(b,(100-j[1])/100));p.filter(".s").css({backgroundColor:d.colors([j[0],100,50],
"array1Circle2Percentage","HSL").toString("rgb")}).children("div").each(function(c){d(this).css("opacity",a[c])});p.filter(".l").css({backgroundColor:d.colors([j[0],j[1],50],"array1Circle2Percentage","HSL").toString("rgb")})}function x(a){q=a;if(q.data("hslLiteColorPickerId")){n=q.children();p=n.children("div.scale");k=q.data("hslLiteColorPickerId");j=l[k].hsl;w=l[k].disabled;r=l[k].onStartChange;s=l[k].onChange;t=l[k].onEndChange}else{k=(new Date).getTime();q.data("hslLiteColorPickerId",k);D();l[k]=
{hsl:j,disabled:w,onStartChange:r,onChange:s,onEndChange:t}}}function F(){var a,b,c,f,e=[[".hslLiteColorPicker",["display","inline-block"]],[".hslLiteColorPicker>div.scale",["height","1.5em"],["border","1px solid #000"],["margin","auto"],["cursor","crosshair"]],[".hslLiteColorPicker>div.scale>span.handle>span",["color","#eee"],["font-size","1.2em"]],[".hslLiteColorPicker>div>span.handle>span.outline",["color","#111"],["font-size","1.4em"]],[".hslLiteColorPicker.disabled>div.scale",["cursor","default"]],
[".hslLiteColorPicker.disabled>div.scale>span.handle>span",["opacity","0.5"],["filter","alpha(opacity=50)"]],[".hslLiteColorPicker .sprite",["background-image","url('"+d.colors.pickers.hslLite.pathToImages+"jquery.colors.pickers.hslLite.sprite.png')"]]],h=document.createElement("style"),i;B=true;/MSIE/.test(navigator.appVersion)||(e=e.concat([[".hslLiteColorPicker .sprite",["background-image","url('data:image/png;charset=\"utf-8\";base64,iVBORw0KGgoAAAANSUhEUgAAA94AAAABEAYAAAB4faoPAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAABFklEQVRYw+1X2w6DIAwFfdD99bKfVkyAbbDGeCk3cTHb6YPNKT3lpG00SmvFy97PvhfOyHddGHM+lsfVvd2O8XP17MeV8mgYvCc8jvt4HSfeOs7xOJ96T279WF3CV5hoKb/uZsQ6l3rObQS3Mam41sTDes7qeWzWqee1d4PLPzK50snEJjRN4XdW6X17eU0jpVLWSmdae28M4cbZjMPxWrzUesYs87e8WB53Xykvr14p77j+vL5et5/n7psQHret983HCM9xwpSxPOfitXip9Ur1r3npdWvz8uqV8qCf4z2c0ZfT/21svTF58W/zrqLj1/Wjn9CPfv6z/rszrdFP6Ec/oR/9hP4Qzxu+F9CPfkI/9gH6w7wnLhg+WFwMyfwAAAAASUVORK5CYII=')"]]]));
h.type="text/css";h.charset="utf-8";h.rel="stylesheet";a=0;for(b=e.length;a<b;a++){i=[e[a][0],"{"];c=1;for(f=e[a].length;c<f;c++)i.push(e[a][c].join(":"),";");i.push("}");e[a]=i.join("")}e=e.join("");a=document.getElementsByTagName("link");if(a.length==0)a=document.getElementsByTagName("style");a.length!=0?document.getElementsByTagName("head")[0].insertBefore(h,a[0]):document.getElementsByTagName("head")[0].appendChild(h);if(h.styleSheet)h.styleSheet.cssText=e;else d(h).text(e)}var g=function(a,b,
c){if(this instanceof g===false)return new g(a,b,c);if(a&&a instanceof g)return a;this.currentModel=g.defaultModel;if(a){if(typeof a=="string")a=d.trim(a);this.inputColor=a;if(b&&b in g.formats&&g.formats[b].validate(a)===true)this.inputFormat=b;else{if(c===undefined)c=b;for(b in g.formats)if(g.formats[b].validate(a)===true){this.inputFormat=b;break}}if(this.inputFormat){b=g.formats[b];this.inputModel=c||b.model||g.defaultInputModel;a=v(b.toModel,this.inputModel,a);if(this.inputModel!=this.currentModel){a=
g.models[this.inputModel].sanitize(a);a=v(g.convertModels[this.inputModel],this.currentModel,a)}this.color=g.models[this.currentModel].sanitize(a)}}else this.color=g.models[this.currentModel].sanitize();if(this.color)return this;else throw"Color format unknown: "+a;};g.prototype={get:z,set:z,model:function(a){if(a===undefined)return this.currentModel;else if(a==this.currentModel)return this;else if(a in g.models){this.color=v(g.convertModels[this.currentModel],a,this.color);this.currentModel=a;return this}else throw"Model does not exist";
},format:function(a){var b=this.currentModel=="RGB"&&a!=="array3Octet1Normalized"?this.format("array3Octet1Normalized"):this.color;if(a&&a in g.formats)return v(g.formats[a].fromModel,this.currentModel,b);else throw"Format does not exist";},toString:function(a){if(!a||a in g.formats===false)a=g.defaultString;try{return this.format(a).toString()}catch(b){return this.format(g.defaultString).toString()}},isFormat:function(a){if(a&&a in g.formats)return g.formats[a].validate(this.inputColor);else throw"Format does not exist";
},mixWith:function(a,b){var c=0,f,e,h,i;if(typeof b=="number")i=b;f=this.get();h=this.model();if(d.isArray(a))try{e=g(a)}catch(m){for(c=0;c<a.length;c++){if(a[c]instanceof g==false)a[c]=g(a[c]);e=c==0?a[c].model(h):e.mixWith(a[c],c/(c+1))}}else{if(a instanceof g==false)a=g(a);e=a}e=e.model(h).get();f=f.slice(0);e=e.slice(0);if(i==undefined)i=c?1/(c+1):0.5;for(c=0;c<f.length;c++){if("cycleMixes"in g.models[h]&&g.models[h].cycleMixes[c])if(g.models[h].cycleMixes[c]>0)for(;f[c]>e[c];)e[c]+=g.models[h].cycleMixes[c];
else for(;f[c]<e[c];)e[c]+=g.models[h].cycleMixes[c];f[c]=f[c]*i+e[c]*(1-i)}f=g.models[h].sanitize(f);return d.extend(d.colors(),{color:f,currentModel:h})}};g.formats={array3Octet:{validate:function(a){var b=0;if(d.isArray(a)&&a.length==3){for(;b<3;)if(typeof a[b]=="number"&&a[b]<=255&&a[b]>=0&&/^\d+$/.test(a[b].toString()))b++;else break;if(b==3)return true}return false},toModel:{RGB:function(a){return a.slice(0,3)}},fromModel:{RGB:function(a){return a.slice(0,3)}}},array3Octet1Normalized:{validate:function(a){var b=
0;if(d.isArray(a)&&a.length==4){for(;b<3;)if(typeof a[b]=="number"&&a[b]<=255&&a[b]>=0&&/^\d+$/.test(a[b].toString()))b++;else break;b==3&&a[3]>=0&&a[3]<=1&&b++;if(b==4)return true}return false},toModel:{RGB:function(a){return a.slice(0,4)}},fromModel:{RGB:function(a){var b=0;for(a=a.slice(0,4);b<3;){a[b]=Math.round(a[b]);b++}return a}}},rgb:{validate:function(a,b){var c=1,f;if(a&&typeof a=="string"&&(f=/^rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)$/.exec(a))){for(;c<4;){f[c]=
parseInt(f[c]);if(f[c]<256)c++;else break}if(c==4)if(b){f.shift();return f.slice(0)}else return true}return false},fromModel:{RGB:function(a){return"rgb("+a[0]+","+a[1]+","+a[2]+")"}},toModel:{RGB:function(a){a=g.formats.rgb.validate(a,true);return a===false?null:a}},model:"RGB"}};g.models={RGB:{sanitize:function(a){var b;if(!a||!d.isArray(a))a=[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.random()];for(;a.length<4;)a.length==3?a.push(1):a.push(0);
a=a.slice(0,4);for(b=0;b<a.length;b++){a[b]||(a[b]=0);if(b<3){if(a[b]>255)a[b]=255;if(a[b]<0)a[b]=0}else if(b==3){a[b]=parseFloat(a[b]);if(a[b]>1)a[b]=1;if(a[b]<0)a[b]=0}}return a},parameterIndexes:{r:0,g:1,b:2,a:3,red:0,green:1,blue:2,alpha:3}}};g.convertModels={};g.defaultInputModel=g.defaultModel="RGB";g.defaultString="rgb";d.colors===undefined&&d.extend({colors:g});var u={HSL:{sanitize:function(a){var b;if(!a||!d.isArray(a))a=[Math.floor(361*Math.random()),Math.floor(101*Math.random()),Math.floor(101*
Math.random()),Math.random()];for(;a.length<4;)a.length==3?a.push(1):a.push(0);a=a.slice(0,4);for(b=0;b<a.length;b++){a[b]||(a[b]=0);a[b]=parseFloat(a[b]);if(b==0){for(;a[b]>360;)a[b]-=360;if(a[b]<0)a[b]+=360}else if(b<3){for(;a[b]>100;)a[b]=100;if(a[b]<0)a[b]=0}else if(b==3){if(a[b]>1)a[b]=1;if(a[b]<0)a[b]=0}}return a},parameterIndexes:{h:0,s:1,l:2,a:3,hue:0,saturation:1,lightness:2,alpha:3},cycleMixes:[360,0,0,0],reverseCylce:function(a){this.cycleMixes[this.parameterIndexes[a]]*=-1}}},C={array1Circle2Percentage:{validate:function(a,
b){var c=0;b=b||3;if(d.isArray(a)&&a.length==b){for(;c<b;)if(typeof a[c]=="number"&&a[c]>=0&&(c==0&&a[c]<=360||(c==1||c==2)&&a[c]<=100||c==3&&a[c]<=1))c++;else break;if(c==b)return true}return false},toModel:{HSL:function(a){return a.slice(0,3)}},fromModel:{HSL:function(a){return a.slice(0,3)}}},array1Circle2Percentage1Normalized:{validate:function(a){return C.array1Circle2Percentage.validate(a,4)},toModel:{HSL:function(a){return a.slice(0,4)}},fromModel:{HSL:function(a){return a.slice(0,4)}}}};d.extend(true,
d.colors.convertModels,{RGB:{HSL:function(a){var b=a[0]/255,c=a[1]/255,f=a[2]/255,e=Math.max(b,c,f),h=Math.min(b,c,f),i=e-h,m=(e+h)/2;if(e==h)b=h=0;else{h=m>0.5?i/(2-e-h):i/(e+h);b=e==b?(c-f)/i+(c<f?6:0):e==c?(f-b)/i+2:(b-c)/i+4;b/=6}return[b*360,h*100,m*100,a[3]]}},HSL:{RGB:function(a){function b(m,y,o){if(o<0)o+=1;if(o>1)o-=1;return o<1/6?m+(y-m)*6*o:o<0.5?y:o<2/3?m+(y-m)*(2/3-o)*6:m}var c,f,e,h,i;e=a[0]/360;f=a[1]/100;c=a[2]/100;if(f==0)c=f=e=c;else{h=c<0.5?c*(1+f):c+f-c*f;i=2*c-h;c=b(i,h,e+1/
3);f=b(i,h,e);e=b(i,h,e-1/3)}return[c*255,f*255,e*255,a[3]]}}});d.extend(d.colors.models,u);d.extend(true,d.colors.formats,C);var B,l={},j,w,r,s,t,q,n,p,k;d.fn.hslLiteColorPicker=function(a){var b,c=[];if(typeof a=="string"&&this.data("hslLiteColorPickerId"))return a==="color"?d.colors(l[this.data("hslLiteColorPickerId")].hsl,"array1Circle2Percentage","HSL"):l[this.data("hslLiteColorPickerId")][a];B||F();b=this.each(function(){x(d(this));if(typeof a=="object"){var f=d.colors.models.HSL.parameterIndexes,
e;for(e in a){if(e in f){l[k].hsl[f[e]]=a[e];delete a[e]}if(e==="color"){if(a[e]instanceof d.colors===false)a[e]=d.colors(a[e]);l[k].hsl=a[e].model("HSL").format("array1Circle2Percentage");delete a[e]}}d.extend(l[k],a);l[k].hsl=d.colors.models.HSL.sanitize(l[k].hsl).slice(0,3);x(q);if("disabled"in a)a.disabled?n.addClass("disabled"):n.removeClass("disabled");d.isFunction(r)&&r(d.colors(j,"array1Circle2Percentage","HSL"));d.isFunction(s)&&s(d.colors(j,"array1Circle2Percentage","HSL"));d.isFunction(t)&&
t(d.colors(j,"array1Circle2Percentage","HSL"))}else a==="hsl"&&c.push(j);A()});return c.length>1?c:c.length==1?c[0]:b};if(d.colors.pickers===undefined)d.colors.pickers={};u=d("script");u=u.eq(u.length-1).attr("src").split("/");u.pop();d.colors.pickers.hslLite={pathToImages:u.join("/")+"/"}})(jQuery);
